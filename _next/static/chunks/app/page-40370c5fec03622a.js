(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2890:(e,t,n)=>{Promise.resolve().then(n.bind(n,6658))},6658:(e,t,n)=>{"use strict";n.d(t,{default:()=>u});var o=n(5155),a=n(2115),r=n(6758),l=n(1799);let c=[{note:"C",color:"white"},{note:"C#",color:"black"},{note:"D",color:"white"},{note:"D#",color:"black"},{note:"E",color:"white"},{note:"F",color:"white"},{note:"F#",color:"black"},{note:"G",color:"white"},{note:"G#",color:"black"},{note:"A",color:"white"},{note:"A#",color:"black"},{note:"B",color:"white"}],s=[];for(let e=2;e<=6;e++)c.forEach(t=>{let{note:n,color:o}=t;if(6===e&&"C"!==n)return;let a="".concat(n).concat(e);s.push({note:a,color:o,octave:e})});let i={C:"Do",D:"Re",E:"Mi",F:"Fa",G:"Sol",A:"La",B:"Si"};function u(){let[e,t]=(0,a.useState)(null),[n,c]=(0,a.useState)(new Set),[u,b]=(0,a.useState)(!1),[d,h]=(0,a.useState)([]),[p]=(0,a.useState)("C"),[g,f]=(0,a.useState)(!1),[m,w]=(0,a.useState)(!1),C=(0,a.useRef)(null),E={C:{type:"sharp",count:0},G:{type:"sharp",count:1},D:{type:"sharp",count:2},A:{type:"sharp",count:3},E:{type:"sharp",count:4},B:{type:"sharp",count:5},F:{type:"flat",count:1},Bb:{type:"flat",count:2},Eb:{type:"flat",count:3},Ab:{type:"flat",count:4},Db:{type:"flat",count:5}},y=(e,t,n)=>{let o={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},a=e.slice(0,-1),r=parseInt(e.slice(-1)),l=o[t],c=(o[n]-l+12)%12,s="sharp"===E[n].type,i=o[a],u=(s?["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"])[(i+c)%12],b=r;return i+c>=12?b++:i+c<0&&b--,"".concat(u).concat(b)};(0,a.useEffect)(()=>{let e=new r.LC({urls:{C4:"C4.mp3","D#4":"Ds4.mp3","F#4":"Fs4.mp3",A4:"A4.mp3"},baseUrl:"https://tonejs.github.io/audio/salamander/",release:1,volume:-12,onload:()=>{console.log("鋼琴音色載入完成")},onerror:e=>{console.error("鋼琴音色載入失敗:",e)}}).toDestination(),n=new r.zb({decay:2.5,wet:.15,preDelay:.01}).toDestination(),o=new r.wf({threshold:-24,ratio:3,attack:.003,release:.25}).toDestination();return e.chain(o,n),t(e),r.oK.bpm.value=120,()=>{e.dispose(),n.dispose(),o.dispose()}},[]);let A=e=>{if(C.current)try{C.current.innerHTML="";let t=new l.$7({renderer:{elementId:"score",width:1e3,height:200}}),n=t.EasyScore(),o=t.System({width:900,spaceBetweenStaves:10}),a=e.map(e=>{let t,{note:n,duration:o}=e,a=n.toLowerCase();switch(o){case"2n":t="h";break;case"4n":default:t="q";break;case"8n":t="8"}return"".concat(a,"/").concat(t)}).join(", "),r=o.addStave({voices:[n.voice(n.notes(a))]}).addClef("treble").addTimeSignature("4/4");t.draw();let c=t.getContext(),s=e.map(e=>e.note),u=r.getBoundingBox(),b=u.w/s.length,d=u.x,h=u.y+u.h+30;s.forEach((e,t)=>{let n=i[e.slice(0,-1).replace(/[#b]/,"")];c.save(),c.setFont("Arial",16),c.fillText(n,d+b*(t+.5)-15,h),c.restore()})}catch(e){console.error("Error drawing score:",e)}},D={C:["C","D","E","F","G","A","B"],G:["G","A","B","C","D","E","F#"],D:["D","E","F#","G","A","B","C#"],A:["A","B","C#","D","E","F#","G#"],E:["E","F#","G#","A","B","C#","D#"],B:["B","C#","D#","E","F#","G#","A#"],F:["F","G","A","Bb","C","D","E"],Bb:["Bb","C","D","Eb","F","G","A"],Eb:["Eb","F","G","Ab","Bb","C","D"],Ab:["Ab","Bb","C","Db","Eb","F","G"],Db:["Db","Eb","F","Gb","Ab","Bb","C"]},x=(e,t)=>{let n=D[p];if(!n)return[];let o=n.findIndex(t=>t===e);if(-1===o)return[];let a=parseInt(t),r="".concat(n[o]).concat(t);return[r,"".concat(n[(o+2)%7]).concat(o+2>=7?a+1:a),"".concat(n[(o+4)%7]).concat(o+4>=7?a+1:a)]};(0,a.useEffect)(()=>{A([{note:"G4",duration:"4n"},{note:"D4",duration:"4n"},{note:"E4",duration:"4n"},{note:"F4",duration:"4n"}])},[]);let v=t=>{e&&!n.has(t)&&(c(e=>new Set(e).add(t)),e.triggerAttack(t,r.tB()))},B=t=>{e&&(c(e=>{let n=new Set(e);return n.delete(t),n}),e.triggerRelease(t,r.tB()))};return(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 gap-8",children:[(0,o.jsxs)("div",{className:"flex gap-4",children:[(0,o.jsx)("button",{onClick:()=>{if(!e||u)return;b(!0),r.ni();let t={C:[["C4","F4","G4","C4"],["C4","A4","F4","G4"],["C4","G4","A4","F4"],["A4","F4","C4","G4"]]},n="C"===p?t.C:t.C.map(e=>e.map(e=>y(e,"C",p))),o=n[Math.floor(Math.random()*n.length)],a=[["4n","4n","4n","4n"],["2n","4n","4n"],["4n","2n","4n"],["4n","8n","8n","4n","4n"],["8n","8n","4n","4n","4n"],["4n","4n","8n","8n","4n"]],l=[],s=0,i=0;a[Math.floor(Math.random()*a.length)].forEach(e=>{let t=o[i],n=t.slice(-1),a=t.slice(0,-1),r=[],c=(r=x(a,n))[Math.floor(Math.random()*r.length)];l.push({note:c,duration:e}),("4n"===e||"2n"===e)&&++s>=2&&(s=0,i=Math.min(i+1,o.length-1))}),h(l),f(!0),A(l);let d=0,g=r.tB();l.forEach(t=>{let n,{note:o,duration:a}=t;switch(a){case"2n":n=1;break;case"4n":default:n=.5;break;case"8n":n=.25}e.triggerAttackRelease(o,a,g+d),setTimeout(()=>{c(new Set([o]))},1e3*d),setTimeout(()=>{c(new Set)},(d+n)*1e3),d+=n}),setTimeout(()=>{b(!1)},1e3*d)},disabled:u,className:"\n            px-6 py-3 rounded-full text-white font-semibold\n            ".concat(u?"bg-gray-400 cursor-not-allowed":"bg-green-500 hover:bg-green-600 active:bg-green-700","\n            transition-colors shadow-lg\n          "),children:u?"播放中...":"重新生成五線譜"}),(0,o.jsx)("button",{onClick:()=>{if(!e||u||0===d.length)return;b(!0),r.ni();let t=0,n=r.tB();d.forEach(o=>{let a,{note:r,duration:l}=o;switch(l){case"2n":a=1;break;case"4n":default:a=.5;break;case"8n":a=.25}e.triggerAttackRelease(r,l,n+t),setTimeout(()=>{c(new Set([r]))},1e3*t),setTimeout(()=>{c(new Set)},(t+a)*1e3),t+=a}),setTimeout(()=>{b(!1)},1e3*t)},disabled:u||!g,className:"\n            px-6 py-3 rounded-full text-white font-semibold\n            ".concat(u||!g?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 active:bg-blue-700","\n            transition-colors shadow-lg\n          "),children:u?"播放中...":"重播旋律"}),(0,o.jsx)("button",{onClick:()=>w(!m),className:"\n            px-6 py-3 rounded-full text-white font-semibold\n            ".concat(m?"bg-purple-600":"bg-purple-500 hover:bg-purple-600"," \n            transition-colors shadow-lg\n          "),children:m?"隱藏五線譜":"顯示五線譜"})]}),(0,o.jsx)("div",{className:"\n          bg-white p-4 rounded-lg shadow-lg\n          transition-all duration-500 ease-in-out\n          ".concat(m?"opacity-100 visible":"opacity-0 invisible","\n          transform ").concat(m?"translate-y-0":"-translate-y-4","\n        "),children:(0,o.jsx)("div",{id:"score",ref:C,style:{minWidth:"500px",minHeight:"200px"}})}),(0,o.jsx)("div",{className:"relative flex overflow-x-auto max-w-full p-4",children:(0,o.jsx)("div",{className:"relative flex",children:s.map((e,t)=>{let a="black"===e.color,r=t>0?s[t-1]:null,l="0px";a?l="-1rem":(null==r?void 0:r.color)==="black"&&(l="0px");let c=e.note.replace(/\d+/,"");return a||"E"!==c&&"B"!==c||(l="0px"),(0,o.jsx)("div",{className:"\n                  relative\n                  ".concat(a?"w-8 h-28 bg-black -ml-4 -mr-4 z-10":"w-14 h-44 bg-white border border-gray-300 z-0","\n                  ").concat(n.has(e.note)?a?"bg-blue-800":"bg-blue-200":"","\n                  rounded-b-md cursor-pointer transition-colors\n                  ").concat(a?"hover:bg-gray-800":"hover:bg-gray-50","\n                  shadow-md\n                "),style:{marginLeft:l},onMouseDown:()=>v(e.note),onMouseUp:()=>B(e.note),onMouseLeave:()=>B(e.note)},e.note)})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[725,491,962,441,684,358],()=>t(2890)),_N_E=e.O()}]);